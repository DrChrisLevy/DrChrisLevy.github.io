<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Levy">
<meta name="dcterms.date" content="2024-05-01">

<title>Chris Levy - Intro to LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Chris Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DrChrisLevy" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/cleavey1985" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Intro to LLMs</h1>
            <p class="subtitle lead">Lunch and Learn Talk</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Chris Levy </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 1, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">May 1, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#env-setup" id="toc-env-setup" class="nav-link active" data-scroll-target="#env-setup">ENV Setup</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#nlp-through-the-years" id="toc-nlp-through-the-years" class="nav-link" data-scroll-target="#nlp-through-the-years">NLP Through The Years</a></li>
  <li><a href="#word-embeddings" id="toc-word-embeddings" class="nav-link" data-scroll-target="#word-embeddings">Word Embeddings</a></li>
  <li><a href="#attention-and-transformers" id="toc-attention-and-transformers" class="nav-link" data-scroll-target="#attention-and-transformers">Attention and Transformers</a></li>
  <li><a href="#transformer-multi-head-attention" id="toc-transformer-multi-head-attention" class="nav-link" data-scroll-target="#transformer-multi-head-attention">Transformer &amp; Multi-Head Attention</a></li>
  <li><a href="#what-is-a-llm-large-language-model" id="toc-what-is-a-llm-large-language-model" class="nav-link" data-scroll-target="#what-is-a-llm-large-language-model">What is a LLM (large language model)?</a></li>
  <li><a href="#next-token-prediction" id="toc-next-token-prediction" class="nav-link" data-scroll-target="#next-token-prediction">Next Token Prediction</a></li>
  <li><a href="#tokenization-with-tiktoken-library" id="toc-tokenization-with-tiktoken-library" class="nav-link" data-scroll-target="#tokenization-with-tiktoken-library">Tokenization with tiktoken library</a></li>
  <li><a href="#tokenization-with-transformers-library" id="toc-tokenization-with-transformers-library" class="nav-link" data-scroll-target="#tokenization-with-transformers-library">Tokenization with transformers library</a></li>
  <li><a href="#tokenization-is-the-first-step" id="toc-tokenization-is-the-first-step" class="nav-link" data-scroll-target="#tokenization-is-the-first-step">Tokenization is the First Step</a></li>
  <li><a href="#llms-are-not-great-at-math.-why" id="toc-llms-are-not-great-at-math.-why" class="nav-link" data-scroll-target="#llms-are-not-great-at-math.-why">LLMS are not great at math. Why?</a></li>
  <li><a href="#basic-transformer-architecture---futher-reading" id="toc-basic-transformer-architecture---futher-reading" class="nav-link" data-scroll-target="#basic-transformer-architecture---futher-reading">Basic Transformer Architecture - Futher Reading</a></li>
  </ul></li>
  <li><a href="#instruction-models" id="toc-instruction-models" class="nav-link" data-scroll-target="#instruction-models">Instruction Models</a>
  <ul class="collapse">
  <li><a href="#base-models-vs-instruct-models" id="toc-base-models-vs-instruct-models" class="nav-link" data-scroll-target="#base-models-vs-instruct-models">Base Models VS Instruct Models</a></li>
  <li><a href="#base-models-vs-instruct-models-1" id="toc-base-models-vs-instruct-models-1" class="nav-link" data-scroll-target="#base-models-vs-instruct-models-1">Base Models VS Instruct Models</a></li>
  <li><a href="#popular-instruction-fine-tuned-llms" id="toc-popular-instruction-fine-tuned-llms" class="nav-link" data-scroll-target="#popular-instruction-fine-tuned-llms">Popular Instruction Fine-Tuned LLMs</a></li>
  <li><a href="#the-gap-is-closing" id="toc-the-gap-is-closing" class="nav-link" data-scroll-target="#the-gap-is-closing">The Gap is closing</a></li>
  <li><a href="#aligning-language-models" id="toc-aligning-language-models" class="nav-link" data-scroll-target="#aligning-language-models">Aligning language models</a></li>
  </ul></li>
  <li><a href="#openai-compatible-llm-inference" id="toc-openai-compatible-llm-inference" class="nav-link" data-scroll-target="#openai-compatible-llm-inference">OpenAI Compatible LLM Inference</a>
  <ul class="collapse">
  <li><a href="#openai-compatible-llm-inference-1" id="toc-openai-compatible-llm-inference-1" class="nav-link" data-scroll-target="#openai-compatible-llm-inference-1">OpenAI Compatible LLM Inference</a></li>
  <li><a href="#openai-compatible-llm-inference-2" id="toc-openai-compatible-llm-inference-2" class="nav-link" data-scroll-target="#openai-compatible-llm-inference-2">OpenAI Compatible LLM Inference</a></li>
  <li><a href="#openai-compatible-llm-inference-3" id="toc-openai-compatible-llm-inference-3" class="nav-link" data-scroll-target="#openai-compatible-llm-inference-3">OpenAI Compatible LLM Inference</a></li>
  <li><a href="#openai-compatible-llm-inference-4" id="toc-openai-compatible-llm-inference-4" class="nav-link" data-scroll-target="#openai-compatible-llm-inference-4">OpenAI Compatible LLM Inference</a></li>
  <li><a href="#chat-templates" id="toc-chat-templates" class="nav-link" data-scroll-target="#chat-templates">Chat Templates</a></li>
  </ul></li>
  <li><a href="#structured-output" id="toc-structured-output" class="nav-link" data-scroll-target="#structured-output">Structured Output</a>
  <ul class="collapse">
  <li><a href="#structured-output-1" id="toc-structured-output-1" class="nav-link" data-scroll-target="#structured-output-1">Structured Output</a></li>
  <li><a href="#structured-output-2" id="toc-structured-output-2" class="nav-link" data-scroll-target="#structured-output-2">Structured Output</a></li>
  <li><a href="#structured-output-3" id="toc-structured-output-3" class="nav-link" data-scroll-target="#structured-output-3">Structured Output</a></li>
  <li><a href="#function-calling" id="toc-function-calling" class="nav-link" data-scroll-target="#function-calling">Function Calling</a></li>
  </ul></li>
  <li><a href="#rag-retrieval-augmented-generation" id="toc-rag-retrieval-augmented-generation" class="nav-link" data-scroll-target="#rag-retrieval-augmented-generation">RAG: Retrieval Augmented Generation</a>
  <ul class="collapse">
  <li><a href="#rag-step-1---index-your-documents" id="toc-rag-step-1---index-your-documents" class="nav-link" data-scroll-target="#rag-step-1---index-your-documents">RAG: Step 1 - Index your Documents</a></li>
  <li><a href="#rag-step-2---query-and-prompt-llm" id="toc-rag-step-2---query-and-prompt-llm" class="nav-link" data-scroll-target="#rag-step-2---query-and-prompt-llm">RAG: Step 2 - Query and Prompt LLM</a></li>
  <li><a href="#rag-resources" id="toc-rag-resources" class="nav-link" data-scroll-target="#rag-resources">RAG Resources</a></li>
  </ul></li>
  <li><a href="#multimodal" id="toc-multimodal" class="nav-link" data-scroll-target="#multimodal">MultiModal</a>
  <ul class="collapse">
  <li><a href="#multimodal-1" id="toc-multimodal-1" class="nav-link" data-scroll-target="#multimodal-1">MultiModal</a></li>
  <li><a href="#multimodal-2" id="toc-multimodal-2" class="nav-link" data-scroll-target="#multimodal-2">MultiModal</a></li>
  <li><a href="#multimodal-3" id="toc-multimodal-3" class="nav-link" data-scroll-target="#multimodal-3">MultiModal</a></li>
  <li><a href="#multimodal-4" id="toc-multimodal-4" class="nav-link" data-scroll-target="#multimodal-4">MultiModal</a></li>
  <li><a href="#multimodal-5" id="toc-multimodal-5" class="nav-link" data-scroll-target="#multimodal-5">MultiModal</a></li>
  <li><a href="#multimodal-6" id="toc-multimodal-6" class="nav-link" data-scroll-target="#multimodal-6">MultiModal</a></li>
  <li><a href="#code-interpreter-data-analysis" id="toc-code-interpreter-data-analysis" class="nav-link" data-scroll-target="#code-interpreter-data-analysis">Code Interpreter (Data Analysis)</a></li>
  </ul></li>
  <li><a href="#fine-tuning" id="toc-fine-tuning" class="nav-link" data-scroll-target="#fine-tuning">Fine Tuning</a>
  <ul class="collapse">
  <li><a href="#fine-tuning-1" id="toc-fine-tuning-1" class="nav-link" data-scroll-target="#fine-tuning-1">Fine Tuning</a></li>
  </ul></li>
  <li><a href="#agents" id="toc-agents" class="nav-link" data-scroll-target="#agents">Agents</a>
  <ul class="collapse">
  <li><a href="#agents-1" id="toc-agents-1" class="nav-link" data-scroll-target="#agents-1">Agents</a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#resources-1" id="toc-resources-1" class="nav-link" data-scroll-target="#resources-1">Resources</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="llm_talk_slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:56.074610Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:55.824442Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="env-setup" class="level1 smaller">
<h1 class="smaller">ENV Setup</h1>
<ul>
<li>create a virtual env</li>
</ul>
<pre><code>python3 -m venv env
source env/bin/activate</code></pre>
<ul>
<li>install packages</li>
</ul>
<pre><code>pip install tiktoken
pip install openai
pip install instructor
pip install transformers
pip install torch
pip install python-dotenv
pip install notebook</code></pre>
<ul>
<li>add env vars in .env file</li>
</ul>
<pre><code>OPENAI_API_KEY=&lt;key&gt;
TOGETHER_API_KEY=&lt;key&gt;</code></pre>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<section id="nlp-through-the-years" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="nlp-through-the-years">NLP Through The Years</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/ELIZA#Response_and_legacy">ELIZA (MIT),1964-1967</a>, <a href="https://docs.google.com/presentation/d/1oXPs3LXtIVIsVbwTyGjAWj_aWvak9c1uNC4uhkS6glk/edit#slide=id.gea1aecfd7b_0_0">CS25 V4: Lecture 1 (Spring 2024)</a></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="imgs/eliza.png" style="width:80.0%"></p>
</div><div class="column" style="width:50%;">
<p><img src="imgs/timeline.png" style="width:80.0%"></p>
</div>
</div>
</section>
<section id="word-embeddings" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="word-embeddings">Word Embeddings</h2>
<ul>
<li>represent each word as an embedding (vector of numbers)</li>
<li>useful computations such as distance (cosine/euclidean)</li>
<li>mapping of words onto a semantic space</li>
<li>example: Word2Vec (2013), GloVe, BERT, ELMo</li>
</ul>
<p><img src="imgs/word-vectors.png" class="img-fluid"></p>
</section>
<section id="attention-and-transformers" class="level2">
<h2 class="anchored" data-anchor-id="attention-and-transformers">Attention and Transformers</h2>
<ul>
<li><a href="https://github.com/nlp-with-transformers/notebooks/blob/main/03_transformer-anatomy.ipynb">Image Source: nlp-with-transformers book</a></li>
</ul>
<p><img src="imgs/self-attention.png"></p>
</section>
<section id="transformer-multi-head-attention" class="level2">
<h2 class="anchored" data-anchor-id="transformer-multi-head-attention">Transformer &amp; Multi-Head Attention</h2>
<ul>
<li><a href="https://arxiv.org/pdf/1706.03762.pdf">Attention Is All you Need: Paper</a></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="imgs/attention-transformer-paper1.png" style="width:70.0%"></p>
</div><div class="column" style="width:50%;">
<p><img src="imgs/attention-transformer-paper2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="what-is-a-llm-large-language-model" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-llm-large-language-model">What is a LLM (large language model)?</h2>
<ul>
<li>LLMs are scaled up versions of the Transformer architecture (millions/billions of parameters)</li>
<li>Most modern LLMs are <strong>decoder only transformers</strong></li>
<li>Trained on massive amounts of ‚Äúgeneral‚Äù textual data</li>
<li>Training objective is typically ‚Äúnext token prediction‚Äù: P(Wt+1|Wt,Wt-1,‚Ä¶,W1)</li>
</ul>
</section>
<section id="next-token-prediction" class="level2">
<h2 class="anchored" data-anchor-id="next-token-prediction">Next Token Prediction</h2>
<ul>
<li>LLMs are next token predictors</li>
<li>‚ÄúIt is raining today, so I will take my _______.‚Äù</li>
</ul>
<p><img src="imgs/next_token1.png" class="img-fluid"></p>
<p><img src="imgs/next_token2.png" class="img-fluid"></p>
</section>
<section id="tokenization-with-tiktoken-library" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="tokenization-with-tiktoken-library">Tokenization with tiktoken library</h2>
<ul>
<li>The first step is to convert the input text into <strong>tokens</strong></li>
<li>Each <strong>token</strong> has an id in the vocabulary</li>
</ul>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:56.202692Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:55.850498Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tiktoken</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>enc <span class="op">=</span> tiktoken.encoding_for_model(<span class="st">"gpt-4-0125"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>encoded_text <span class="op">=</span> enc.encode(<span class="st">"tiktoken is great!"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>encoded_text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>[83, 1609, 5963, 374, 2294, 0]</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:56.204961Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:56.070180Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>[enc.decode([token]) <span class="cf">for</span> token <span class="kw">in</span> encoded_text]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>['t', 'ik', 'token', ' is', ' great', '!']</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:56.213894Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:56.076343Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>enc.decode([<span class="dv">83</span>, <span class="dv">1609</span>, <span class="dv">5963</span>, <span class="dv">374</span>, <span class="dv">2294</span>, <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>'tiktoken is great!'</code></pre>
</div>
</div>
</section>
<section id="tokenization-with-transformers-library" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="tokenization-with-transformers-library">Tokenization with transformers library</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:58.055428Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:56.080789Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"bert-base-uncased"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> [</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"I love summer"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"I love tacos"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> tokenizer(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    texts,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    return_tensors<span class="op">=</span><span class="st">"pt"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">=</span><span class="st">"max_length"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    max_length<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    truncation<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>).input_ids</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inputs)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inputs.shape)  <span class="co"># (B, T)</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tokenizer.vocab_size)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> inputs:</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tokenizer.convert_ids_to_tokens(row))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([[  101,  1045,  2293,  2621,   102,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0],
        [  101,  1045,  2293, 11937, 13186,   102,     0,     0,     0,     0,
             0,     0,     0,     0,     0,     0]])
torch.Size([2, 16])
30522
['[CLS]', 'i', 'love', 'summer', '[SEP]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]']
['[CLS]', 'i', 'love', 'ta', '##cos', '[SEP]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]', '[PAD]']</code></pre>
</div>
</div>
</section>
<section id="tokenization-is-the-first-step" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="tokenization-is-the-first-step">Tokenization is the First Step</h2>
<p><img src="imgs/first_step.png" class="img-fluid"></p>
</section>
<section id="llms-are-not-great-at-math.-why" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="llms-are-not-great-at-math.-why">LLMS are not great at math. Why?</h2>
<ul>
<li>because of tokenization and next token prediction</li>
</ul>
<p>What is the average of: 2009 1746 4824 8439</p>
<p><img src="imgs/llms_suck_at_math.png" class="img-fluid"></p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:58.059277Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:58.056574Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>encoded_text <span class="op">=</span> enc.encode(<span class="st">"What is the average of:  2009 1746 4824 8439"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(encoded_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[3923, 374, 279, 5578, 315, 25, 220, 220, 1049, 24, 220, 11771, 21, 220, 21984, 19, 220, 23996, 24]</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:58.062900Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:58.059913Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([enc.decode([token]) <span class="cf">for</span> token <span class="kw">in</span> encoded_text])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['What', ' is', ' the', ' average', ' of', ':', ' ', ' ', '200', '9', ' ', '174', '6', ' ', '482', '4', ' ', '843', '9']</code></pre>
</div>
</div>
</section>
<section id="basic-transformer-architecture---futher-reading" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="basic-transformer-architecture---futher-reading">Basic Transformer Architecture - Futher Reading</h2>
<ul>
<li>Lots of resources online</li>
<li>Some of the ones I enjoyed while learning:
<ul>
<li>Chapter 3 of the book <a href="https://www.oreilly.com/library/view/natural-language-processing/9781098136789/">Natural Language Processing With Transformers</a></li>
<li>Andrej Karpathy‚Äôs video <a href="https://www.youtube.com/watch?v=kCc8FmEb1nY">Let‚Äôs build GPT: from scratch, in code, spelled out</a></li>
<li>Sebastian Raschka‚Äôs Blog Post <a href="https://magazine.sebastianraschka.com/p/understanding-and-coding-self-attention">Understanding and Coding Self-Attention, Multi-Head Attention, Cross-Attention, and Causal-Attention in LLMs</a></li>
<li>Omar Sanseviero‚Äôs Blog Post <a href="https://osanseviero.github.io/hackerllama/blog/posts/random_transformer/">The Random Transformer</a></li>
<li><a href="https://jalammar.github.io/illustrated-transformer/">The Illustrated Transformer</a></li>
<li>The original paper: <a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a></li>
</ul></li>
</ul>
</section>
</section>
<section id="instruction-models" class="level1">
<h1>Instruction Models</h1>
<section id="base-models-vs-instruct-models" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="base-models-vs-instruct-models">Base Models VS Instruct Models</h2>
<ul>
<li><code>meta-llama/Meta-Llama-3-8B</code> (base model)</li>
</ul>
<p><img src="imgs/base_model_example.png" class="img-fluid"></p>
</section>
<section id="base-models-vs-instruct-models-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="base-models-vs-instruct-models-1">Base Models VS Instruct Models</h2>
<ul>
<li><code>meta-llama/Meta-Llama-3-8B-Instruct</code></li>
</ul>
<p><img src="imgs/instruct_model_example.png" class="img-fluid"></p>
</section>
<section id="popular-instruction-fine-tuned-llms" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="popular-instruction-fine-tuned-llms">Popular Instruction Fine-Tuned LLMs</h2>
<ul>
<li>closed
<ul>
<li><a href="https://platform.openai.com/docs/models">Open AI</a>: <code>gpt-4-turbo-2024-04-09</code>, <code>gpt-3.5-turbo-0125</code>, etc.</li>
<li><a href="https://docs.anthropic.com/claude/docs/models-overview">Anthropic</a>: <code>opus</code>, <code>sonnet</code>, <code>haiku</code></li>
<li><a href="https://blog.google/technology/ai/google-gemini-next-generation-model-february-2024/">Google</a>, <code>Gemini 1.5</code></li>
</ul></li>
<li>open
<ul>
<li><a href="https://llama.meta.com/llama3/">Meta</a>: <code>Llama-3-8B-Instruct</code>, <code>Llama-3-70B-Instruct</code></li>
<li><a href="https://mistral.ai/technology/#models">Mistral</a>: <code>Mistral 7B</code>, <code>Mixtral 8x7B</code>, <code>Mixtral 8x22B</code></li>
<li><a href="https://github.com/QwenLM/Qwen">Qwen</a>: <code>Qwen-1.8B</code>, <code>Qwen-7B</code>, <code>Qwen-14B</code>, <code>Qwen-72B</code></li>
<li><a href="https://huggingface.co/HuggingFaceH4">HuggingFace</a>: <code>Zephyr-ORPO-141b-A35b-v0.1</code></li>
<li><a href="DBRX-Instruct-Preview">Databricks</a>: <code>DBRX-Instruct-Preview</code></li>
<li><a href="https://nousresearch.com/releases/">NousResearch</a>: <code>Hermes-2-Pro-Mistral-7B</code>,</li>
<li><a href="https://docs.cohere.com/docs/command-r-plus">Cohere</a>: <code>Command R+</code></li>
</ul></li>
</ul>
</section>
<section id="the-gap-is-closing" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="the-gap-is-closing">The Gap is closing</h2>
<ul>
<li><a href="https://x.com/maximelabonne/status/1779801605702836454">image source - Maxime Labonne</a>, <a href="https://chat.lmsys.org/?leaderboard">üèÜ LMSYS Chatbot Arena</a></li>
<li><a href="https://x.com/jannchie/status/1784621770018058651">another fun animation</a> <img src="imgs/closed_vs_open.png" class="img-fluid"></li>
</ul>
</section>
<section id="aligning-language-models" class="level2">
<h2 class="anchored" data-anchor-id="aligning-language-models">Aligning language models</h2>
<ul>
<li>There is so much theory/research behind creating instruction models</li>
<li>Not going to cover that here</li>
<li><a href="https://docs.google.com/presentation/d/1quMyI4BAx4rvcDfk8jjv063bmHg4RxZd9mhQloXpMn0/edit#slide=id.g2ca00c5c0f9_0_0">Checkout this recent talk, Aligning open language models, from Nathan Lambert</a></li>
<li><a href="https://www.youtube.com/watch?v=bZQun8Y4L2A">State of GPT Keynote By Andrej Karpathy</a></li>
<li><a href="https://github.com/mlabonne/llm-course">Large Language Model Course by Maxime Labonne</a></li>
</ul>
</section>
</section>
<section id="openai-compatible-llm-inference" class="level1">
<h1>OpenAI Compatible LLM Inference</h1>
<section id="openai-compatible-llm-inference-1" class="level2">
<h2 class="anchored" data-anchor-id="openai-compatible-llm-inference-1">OpenAI Compatible LLM Inference</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:14:59.505405Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:58.061916Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> openai.OpenAI()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>chat_completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-3.5-turbo-0125"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Who are the main characters from Lord of the Rings?."</span>},</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> chat_completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The main characters from Lord of the Rings are Frodo Baggins, Samwise Gamgee, Aragorn, Legolas, Gimli, Gandalf, Boromir, Merry and Pippin, and Gollum.</code></pre>
</div>
</div>
</section>
<section id="openai-compatible-llm-inference-2" class="level2">
<h2 class="anchored" data-anchor-id="openai-compatible-llm-inference-2">OpenAI Compatible LLM Inference</h2>
<ul>
<li><a href="https://www.together.ai/">together.ai</a></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="im">import</span> openai</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>client <span class="op">=</span> openai.OpenAI(api_key<span class="op">=</span>os.environ.get(<span class="st">"TOGETHER_API_KEY"</span>), base_url<span class="op">=</span><span class="st">"https://api.together.xyz/v1"</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a>chat_completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb20-5"><a href="#cb20-5"></a>    model<span class="op">=</span><span class="st">"META-LLAMA/LLAMA-3-70B-CHAT-HF"</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>    messages<span class="op">=</span>[</span>
<span id="cb20-7"><a href="#cb20-7"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Who are the main characters from Lord of the Rings?."</span>},</span>
<span id="cb20-8"><a href="#cb20-8"></a>    ],</span>
<span id="cb20-9"><a href="#cb20-9"></a>)</span>
<span id="cb20-10"><a href="#cb20-10"></a>response <span class="op">=</span> chat_completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="openai-compatible-llm-inference-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="openai-compatible-llm-inference-3">OpenAI Compatible LLM Inference</h2>
<ul>
<li><a href="https://www.together.ai/">together.ai</a></li>
</ul>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:04.323267Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:14:59.505704Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> openai.OpenAI(api_key<span class="op">=</span>os.environ.get(<span class="st">"TOGETHER_API_KEY"</span>), base_url<span class="op">=</span><span class="st">"https://api.together.xyz/v1"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>chat_completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"META-LLAMA/LLAMA-3-70B-CHAT-HF"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Who are the main characters from Lord of the Rings?."</span>},</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> chat_completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The main characters from J.R.R. Tolkien's epic fantasy novel "The Lord of the Rings" are:

1. **Frodo Baggins**: The hobbit who inherits the One Ring from Bilbo Baggins and undertakes the perilous journey to destroy it in the fires of Mount Doom.
2. **Samwise Gamgee** (Sam): Frodo's loyal hobbit servant and friend, who accompanies him on his quest.
3. **Aragorn (Strider)**: A human warrior who becomes the leader of the Fellowship of the Ring and helps guide Frodo on his journey. He is the rightful King of Gondor.
4. **Legolas**: An elf archer who joins the Fellowship and provides skilled marksmanship and agility.
5. **Gimli**: A dwarf warrior who joins the Fellowship and provides strength and combat skills.
6. **Gandalf the Grey**: A powerful wizard who helps guide Frodo on his quest and provides wisdom and magical assistance.
7. **Boromir**: A human warrior from the land of Gondor, who joins the Fellowship but ultimately tries to take the Ring from Frodo.
8. **Merry Brandybuck** and **Pippin Took**: Frodo's hobbit cousins, who join the Fellowship and provide comic relief and bravery in the face of danger.
9. **Sauron**: The primary antagonist, a dark lord who created the One Ring and seeks to conquer Middle-earth.
10. **Saruman**: A wizard who betrays Gandalf and allies himself with Sauron, seeking to gain power and control over Middle-earth.

These characters form the core of the story, and their interactions and relationships drive the plot of "The Lord of the Rings".</code></pre>
</div>
</div>
</section>
<section id="openai-compatible-llm-inference-4" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="openai-compatible-llm-inference-4">OpenAI Compatible LLM Inference</h2>
<ul>
<li>local inference with <a href="https://ollama.com/">ollama</a></li>
</ul>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:22.195834Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:04.323425Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> openai.OpenAI(api_key<span class="op">=</span><span class="st">"ollama"</span>, base_url<span class="op">=</span><span class="st">"http://localhost:11434/v1"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>chat_completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"llama3"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Who are the main characters from Lord of the Rings?."</span>},</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> chat_completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The main characters in J.R.R. Tolkien's "Lord of the Rings" trilogy, which includes "The Fellowship of the Ring", "The Two Towers", and "The Return of the King", are:

1. Frodo Baggins: The hobbit who inherits the One Ring from Bilbo and sets out on a quest to destroy it in the fires of Mount Doom.
2. Samwise Gamgee (Sam): Frodo's loyal hobbit servant and friend, who accompanies him on his journey to Mordor.
3. Aragorn (Strider): A human warrior who leads the Fellowship and helps them navigate the perilous lands of Middle-earth.
4. Legolas: An elf archer who joins the Fellowship and fights alongside them against Sauron's armies.
5. Gimli: A dwarf warrior who also joins the Fellowship, seeking to avenge his father's death at the hands of orcs.
6. Boromir: The human son of the Steward of Gondor, who tries to take the One Ring from Frodo for the benefit of his own people.
7. Meriadoc Brandybuck (Merry) and Peregrin Took (Pippin): Two hobbit friends of Frodo's who accompany him on his journey and become embroiled in the quest to destroy the Ring.

These characters, along with Gandalf the Grey, a powerful wizard, and other supporting characters, drive the story and its themes of friendship, sacrifice, and the struggle against evil.</code></pre>
</div>
</div>
</section>
<section id="chat-templates" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="chat-templates">Chat Templates</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:22.441153Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:22.198330Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>checkpoint <span class="op">=</span> <span class="st">"meta-llama/Meta-Llama-3-8B-Instruct"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(checkpoint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Each model has its own expected input format. For Llama3 it‚Äôs this:</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;|begin_of_text|&gt;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">You are a friendly chatbot who always responds in the style of a pirate&lt;|eot_id|&gt;&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">How many helicopters can a human eat in one sitting?&lt;|eot_id|&gt;&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>With chat templates we can use this familiar standard:</li>
</ul>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:22.497923Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:22.440908Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"system"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: <span class="st">"You are a friendly chatbot who always responds in the style of a pirate"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"How many helicopters can a human eat in one sitting?"</span>},</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>tokenized_chat <span class="op">=</span> tokenizer.apply_chat_template(messages, tokenize<span class="op">=</span><span class="va">True</span>, add_generation_prompt<span class="op">=</span><span class="va">True</span>, return_tensors<span class="op">=</span><span class="st">"pt"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tokenizer.decode(tokenized_chat[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;|begin_of_text|&gt;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;

You are a friendly chatbot who always responds in the style of a pirate&lt;|eot_id|&gt;&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;

How many helicopters can a human eat in one sitting?&lt;|eot_id|&gt;&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="structured-output" class="level1">
<h1>Structured Output</h1>
<section id="structured-output-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="structured-output-1">Structured Output</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:27.339931Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:22.468544Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> openai.OpenAI()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>chat_completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-3.5-turbo-0125"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"Who are the main characters from Lord of the Rings?. "</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"For each character give the name, race, "</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"favorite food, skills, weapons, and a fun fact."</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> chat_completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Frodo Baggins
- Race: Hobbit
- Favorite food: Mushrooms
- Skills: Determination, stealth, resilience
- Weapons: Sting (his sword)
- Fun fact: Frodo is the only character to have directly interacted with the One Ring and survived its corrupting influence.

2. Aragorn (also known as Strider)
- Race: Human (Dunedain)
- Favorite food: Lembas bread
- Skills: Swordsmanship, tracking, leadership
- Weapons: Anduril (his sword), bow and arrows
- Fun fact: Aragorn is the heir to the throne of Gondor and the rightful King of Arnor.

3. Gandalf
- Race: Maia (wizard)
- Favorite food: Pipe-weed
- Skills: Magic, wisdom, leadership
- Weapons: Glamdring (his sword), staff
- Fun fact: Gandalf is actually one of the Maiar, a group of powerful beings who serve the Valar (gods) in the world of Middle-earth.

4. Legolas
- Race: Elf
- Favorite food: Waybread (Lembas)
- Skills: Archery, agility, keen eyesight
- Weapons: Bow and arrows, knives
- Fun fact: Legolas is the son of Thranduil, the Elven King of the Woodland Realm in Mirkwood.

5. Gimli
- Race: Dwarf
- Favorite food: Roast meats
- Skills: Axe-fighting, mining, loyalty
- Weapons: Axe, throwing axes
- Fun fact: Gimli is a member of the Fellowship representing the Dwarves, who are known for their craftsmanship and love of gold and jewels.</code></pre>
</div>
</div>
</section>
<section id="structured-output-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="structured-output-2">Structured Output</h2>
<ul>
<li><a href="https://platform.openai.com/docs/guides/text-generation/json-mode">JSON mode</a> and <a href="https://platform.openai.com/docs/guides/function-calling">Function Calling</a> give us structured output</li>
<li><a href="https://github.com/jxnl/instructor">instructor - library</a> - <a href="https://www.youtube.com/watch?v=yj-wSRJwrrc">‚ÄúPydantic is all you need‚Äù</a></li>
</ul>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:28.054711Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:27.349766Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> instructor</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> instructor.from_openai(openai.OpenAI())</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define your desired output structure</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserInfo(BaseModel):</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract structured data from natural language</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>user_info <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-3.5-turbo-0125"</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    response_model<span class="op">=</span>UserInfo,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Chris is 38 years old."</span>}],</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user_info.model_dump())</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user_info.name)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user_info.age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'name': 'Chris', 'age': 38}
Chris
38</code></pre>
</div>
</div>
</section>
<section id="structured-output-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="structured-output-3">Structured Output</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:28.067840Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:28.056823Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> instructor</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, field_validator</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> instructor.from_openai(openai.OpenAI())</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Character(BaseModel):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    race: <span class="bu">str</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    fun_fact: <span class="bu">str</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    favorite_food: <span class="bu">str</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    skills: List[<span class="bu">str</span>]</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    weapons: List[<span class="bu">str</span>]</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Characters(BaseModel):</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    characters: List[Character]</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">@field_validator</span>(<span class="st">"characters"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validate_characters(cls, v):</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(v) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"The number of characters must be at least 10, but it is </span><span class="sc">{</span><span class="bu">len</span>(v)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:35.427043Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:28.072249Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-3.5-turbo-0125"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"Who are the main characters from Lord of the Rings?. "</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"For each character give the name, race, "</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"favorite food, skills, weapons, and a fun fact. Give me at least 10 different characters."</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    response_model<span class="op">=</span>Characters,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    max_retries<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>pprint(response.model_dump())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'characters': [{'favorite_food': 'Mushrooms',
                 'fun_fact': 'Frodo is the nephew of Bilbo Baggins.',
                 'name': 'Frodo Baggins',
                 'race': 'Hobbit',
                 'skills': ['Ringbearer', 'Stealth', 'Courage'],
                 'weapons': ['Sting', 'Phial of Galadriel']},
                {'favorite_food': 'Lembas bread',
                 'fun_fact': 'Aragorn is the rightful heir to the throne of '
                             'Gondor.',
                 'name': 'Aragorn',
                 'race': 'Man',
                 'skills': ['Swordsmanship', 'Leadership', 'Tracking'],
                 'weapons': ['Anduril', 'Bow and Arrow']},
                {'favorite_food': 'Roast Pork',
                 'fun_fact': 'Gimli is the son of Gloin, one of the Dwarves in '
                             "'The Hobbit'.",
                 'name': 'Gimli',
                 'race': 'Dwarf',
                 'skills': ['Axe throwing', 'Smithing', 'Courage'],
                 'weapons': ['Axe', 'Throwing Axe']},
                {'favorite_food': 'Lembas bread',
                 'fun_fact': 'Legolas has keen eyesight and can spot enemies '
                             'from great distances.',
                 'name': 'Legolas',
                 'race': 'Elf',
                 'skills': ['Archery', 'Agility', 'Sight'],
                 'weapons': ['Bow', 'Arrow']},
                {'favorite_food': 'Pipe-weed',
                 'fun_fact': 'Gandalf is also known as Mithrandir in Elvish.',
                 'name': 'Gandalf',
                 'race': 'Maia',
                 'skills': ['Wizardry', 'Wisdom', 'Combat'],
                 'weapons': ['Glamdring', 'Staff']},
                {'favorite_food': 'Venison',
                 'fun_fact': 'Boromir hails from the realm of Gondor.',
                 'name': 'Boromir',
                 'race': 'Man',
                 'skills': ['Swordsmanship', 'Leadership', 'Athletics'],
                 'weapons': ['Sword', 'Shield']},
                {'favorite_food': 'Potatoes',
                 'fun_fact': 'Sam is known for his unwavering loyalty to '
                             'Frodo.',
                 'name': 'Samwise Gamgee',
                 'race': 'Hobbit',
                 'skills': ['Gardening', 'Loyalty', 'Cooking'],
                 'weapons': ['Cooking pot', 'Gardening tools']},
                {'favorite_food': 'Berry tarts',
                 'fun_fact': 'Arwen is the daughter of Elrond, Lord of '
                             'Rivendell.',
                 'name': 'Arwen',
                 'race': 'Half-Elf',
                 'skills': ['Horseback riding', 'Healing', 'Sword fighting'],
                 'weapons': ['Sword']},
                {'favorite_food': 'Apple pie',
                 'fun_fact': "Merry is one of Frodo's close friends and part "
                             'of the Fellowship of the Ring.',
                 'name': 'Merry Brandybuck',
                 'race': 'Hobbit',
                 'skills': ['Stealth', 'Swordsmanship', 'Cooking'],
                 'weapons': ['Dagger', 'Sword']},
                {'favorite_food': 'Mushrooms',
                 'fun_fact': 'Pippin becomes a Knight of Gondor for his '
                             'bravery in battle.',
                 'name': 'Pippin Took',
                 'race': 'Hobbit',
                 'skills': ['Loyalty', 'Entertainment', 'Courage'],
                 'weapons': ['Dagger', 'Sword']}]}</code></pre>
</div>
</div>
</section>
<section id="function-calling" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="function-calling">Function Calling</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:15:58.998954Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:35.430315Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> [</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"function"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"function"</span>: {</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: <span class="st">"get_weather_forecast"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"Provides a weather forecast for a given location and date."</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"parameters"</span>: {</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"object"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"properties"</span>: {<span class="st">"location"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>}, <span class="st">"date"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>}},</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"required"</span>: [<span class="st">"location"</span>, <span class="st">"date"</span>],</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"function"</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"function"</span>: {</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: <span class="st">"book_flight"</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"Book a flight."</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"parameters"</span>: {</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"object"</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"properties"</span>: {</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"departure_city"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>},</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"arrival_city"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>},</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"departure_date"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>},</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"return_date"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>},</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"num_passengers"</span>: {<span class="st">"type"</span>: <span class="st">"integer"</span>},</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cabin_class"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>},</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"required"</span>: [</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"departure_city"</span>,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"arrival_city"</span>,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"departure_date"</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"return_date"</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"num_passengers"</span>,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cabin_class"</span>,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"function"</span>,</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"function"</span>: {</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: <span class="st">"send_slack_message"</span>,</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"Send a slack message to specific channel."</span>,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">"parameters"</span>: {</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"object"</span>,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">"properties"</span>: {<span class="st">"channel_name"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>}, <span class="st">"message"</span>: {<span class="st">"type"</span>: <span class="st">"string"</span>}},</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">"required"</span>: [<span class="st">"channel_name"</span>, <span class="st">"message"</span>],</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> openai.OpenAI()</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>chat_completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4-turbo"</span>,</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="ss">f"Today's date is </span><span class="sc">{</span>date<span class="sc">.</span>today()<span class="sc">}</span><span class="ss">"</span>},</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"""This coming Friday I need to book a flight from Halifax, NS to Austin, Texas. </span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="st">                                    It will be me and my friend and we need first class seats. </span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="st">                                    We will come back on Sunday. Let me know what I should pack for clothes </span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="st">                                    according to the weather there each day. Also please remind my team on </span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a><span class="st">                                    the DEV slack channel that I will be out of office on Friday. </span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="st">                                    1. Book the flight. </span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a><span class="st">                                    2. Let me know the weather. </span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a><span class="st">                                    3. Send the slack message."""</span>,</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>    tools<span class="op">=</span>tools,</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tool <span class="kw">in</span> chat_completion.choices[<span class="dv">0</span>].message.tool_calls:</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"function name: </span><span class="sc">{</span>tool<span class="sc">.</span>function<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"function arguments: </span><span class="sc">{</span>json<span class="sc">.</span>loads(tool.function.arguments)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function name: book_flight
function arguments: {'departure_city': 'Halifax', 'arrival_city': 'Austin', 'departure_date': '2024-05-03', 'return_date': '2024-05-05', 'num_passengers': 2, 'cabin_class': 'First'}

function name: get_weather_forecast
function arguments: {'location': 'Austin, Texas', 'date': '2024-05-03'}

function name: get_weather_forecast
function arguments: {'location': 'Austin, Texas', 'date': '2024-05-04'}

function name: get_weather_forecast
function arguments: {'location': 'Austin, Texas', 'date': '2024-05-05'}

function name: send_slack_message
function arguments: {'channel_name': 'DEV', 'message': 'I will be out of office this Friday, May 3, 2024. Please reach out via email if urgent.'}</code></pre>
</div>
</div>
</section>
</section>
<section id="rag-retrieval-augmented-generation" class="level1 smaller">
<h1 class="smaller">RAG: Retrieval Augmented Generation</h1>
<section id="rag-step-1---index-your-documents" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="rag-step-1---index-your-documents">RAG: Step 1 - Index your Documents</h2>
<ul>
<li>RAG is a technique for augmenting LLM knowledge with additional data.</li>
<li>image source: <a href="https://python.langchain.com/docs/use_cases/question_answering/">langchain docs</a></li>
</ul>
<p><img src="imgs/rag_part1.png" class="img-fluid"></p>
</section>
<section id="rag-step-2---query-and-prompt-llm" class="level2">
<h2 class="anchored" data-anchor-id="rag-step-2---query-and-prompt-llm">RAG: Step 2 - Query and Prompt LLM</h2>
<p><img src="imgs/rag_part2.png" style="width:60.0%"></p>
</section>
<section id="rag-resources" class="level2">
<h2 class="anchored" data-anchor-id="rag-resources">RAG Resources</h2>
<ul>
<li>Vector DBs
<ul>
<li><a href="https://weaviate.io/developers/weaviate/starter-guides/generative">weaviate</a></li>
<li><a href="https://www.pinecone.io/learn/retrieval-augmented-generation/">pinecone</a></li>
<li><a href="https://blog.vespa.ai/scaling-personal-ai-assistants-with-streaming-mode/">vespa</a></li>
<li><a href="https://qdrant.tech/articles/what-is-rag-in-ai/">qdrant</a></li>
</ul></li>
<li>LLM Frameworks: (not necessary for building on prod but good for learning and POC)
<ul>
<li><a href="https://www.llamaindex.ai/">LlamaIndex</a></li>
<li><a href="https://python.langchain.com/docs/use_cases/question_answering/">langchain</a></li>
</ul></li>
</ul>
</section>
</section>
<section id="multimodal" class="level1">
<h1>MultiModal</h1>
<section id="multimodal-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="multimodal-1">MultiModal</h2>
<p><img src="https://i.pinimg.com/736x/6e/71/0d/6e710de5084379ba6a57b77e6579084f.jpg" class="img-fluid"></p>
</section>
<section id="multimodal-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="multimodal-2">MultiModal</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:16:08.931509Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:15:59.003526Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4-turbo"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: [</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"type"</span>: <span class="st">"text"</span>, <span class="st">"text"</span>: <span class="st">"What is unusual about this image?"</span>},</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"url"</span>: <span class="st">"https://i.pinimg.com/736x/6e/71/0d/6e710de5084379ba6a57b77e6579084f.jpg"</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.choices[<span class="dv">0</span>].message.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The unusual aspect of this image is a man ironing clothes on an ironing board placed on top of a taxi in the middle of a busy street. This is an uncommon sight, as ironing typically takes place in domestic or commercial indoor settings. The juxtaposition of such a mundane, home-based activity with the fast-paced, outdoor environment of a city street is quite remarkable and humorous. Additionally, both the ironing board and the taxi are branded with the same logo, suggesting that this scene might be part of a promotional event or public stunt to attract attention.</code></pre>
</div>
</div>
</section>
<section id="multimodal-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="multimodal-3">MultiModal</h2>
<p><img src="https://media.makeameme.org/created/it-worked-fine.jpg" class="img-fluid"></p>
</section>
<section id="multimodal-4" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="multimodal-4">MultiModal</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-05-01T01:44:30.863286Z&quot;,&quot;start_time&quot;:&quot;2024-05-01T01:44:23.170706Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4-turbo"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: [</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"type"</span>: <span class="st">"text"</span>, <span class="st">"text"</span>: <span class="st">"What is in this image?"</span>},</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"url"</span>: <span class="st">"https://media.makeameme.org/created/it-worked-fine.jpg"</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.choices[<span class="dv">0</span>].message.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The image is a meme featuring two juxtaposed elements. In the background, there is a scene of a house on fire with firefighters and emergency responders at the site, attempting to manage the situation. In the foreground, there is a young girl smirking at the camera with a knowing expression. Overlaid text reads, "IT WORKED FINE IN DEV, IT'S A DEVOPS PROBLEM NOW," humorously suggesting that a problem developed during the software development stage is now a problem for the DevOps team to handle. The meme uses the incongruity between the calm and mischievous expression of the girl and the chaotic scene behind her to underline its comedic message about shifting blame in a development context.</code></pre>
</div>
</div>
</section>
<section id="multimodal-5" class="level2">
<h2 class="anchored" data-anchor-id="multimodal-5">MultiModal</h2>
<p><img src="https://storage.googleapis.com/pai-images/a6d0952a331d40489b216e7f3f1ff6ed.jpeg" class="img-fluid"></p>
</section>
<section id="multimodal-6" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="multimodal-6">MultiModal</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-04-30T23:16:37.171132Z&quot;,&quot;start_time&quot;:&quot;2024-04-30T23:16:26.697260Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4-turbo"</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: [</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"text"</span>: <span class="st">"Give me a long list of visual search tags/keywords so I can "</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"index this image in my visual search index. Respond in JSON format {'labels': ['label1', ...]}"</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"url"</span>: <span class="st">"https://storage.googleapis.com/pai-images/a6d0952a331d40489b216e7f3f1ff6ed.jpeg"</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    response_format<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"json_object"</span>},</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.choices[<span class="dv">0</span>].message.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
  "labels": [
    "animated character",
    "wizard",
    "Minion",
    "fantasy",
    "3D illustration",
    "cute",
    "magic",
    "staff",
    "long beard",
    "blue hat",
    "glasses",
    "overalls",
    "adventure",
    "comical character",
    "grey beard",
    "wooden staff",
    "round glasses",
    "yellow",
    "character design",
    "creative",
    "digital art",
    "sorcerer",
    "cartoon",
    "funny",
    "elderly character",
    "mystical",
    "storybook",
    "cloak",
    "leather belt",
    "buckle"
  ]
}</code></pre>
</div>
</div>
</section>
<section id="code-interpreter-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="code-interpreter-data-analysis">Code Interpreter (Data Analysis)</h2>
<ul>
<li>give the LLM access to Python</li>
<li>your own little data analyst to give tasks to</li>
</ul>
<p><a href="https://chat.openai.com/c/2a470564-6868-408a-ae61-b7c1c24c40a5">example</a></p>
</section>
</section>
<section id="fine-tuning" class="level1">
<h1>Fine Tuning</h1>
<section id="fine-tuning-1" class="level2">
<h2 class="anchored" data-anchor-id="fine-tuning-1">Fine Tuning</h2>
<ul>
<li>todo</li>
<li><a href="https://github.com/OpenAccess-AI-Collective/axolotl?tab=readme-ov-file">axolotl</a></li>
<li><a href="https://github.com/pytorch/torchtune">torchtune</a></li>
</ul>
</section>
</section>
<section id="agents" class="level1">
<h1>Agents</h1>
<section id="agents-1" class="level2">
<h2 class="anchored" data-anchor-id="agents-1">Agents</h2>
<ul>
<li>todo</li>
</ul>
</section>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
</section>
<section id="resources-1" class="level1 smaller">
<h1 class="smaller">Resources</h1>
<div class="columns">
<div class="column" style="width:33%;">
<ul>
<li><a href="https://x.com/jeremyphoward">Jeremy Howard</a>
<ul>
<li><a href="https://www.youtube.com/watch?v=jkrNMKz9pWU&amp;t=186s">A Hackers‚Äô Guide to Language Models</a></li>
</ul></li>
<li><a href="https://twitter.com/HamelHusain">Hamel Husain</a></li>
<li><a href="https://twitter.com/maximelabonne">Maxime Labonne</a></li>
<li><a href="https://twitter.com/rasbt">Sebastian Raschka</a></li>
<li><a href="https://twitter.com/abacaj">anton</a></li>
<li><a href="https://twitter.com/Teknium1">Teknium</a></li>
<li><a href="https://twitter.com/simonw">Simon Willison</a></li>
<li><a href="https://open.spotify.com/show/2J3lqMPD0BUI0bF9KJYKc1?si=9eed369fd01a4ade">ThursdAI podcast</a></li>
<li><a href="https://www.latent.space/">Latent Space</a></li>
</ul>
</div><div class="column" style="width:33%;">
<ul>
<li><a href="https://twitter.com/JayAlammar">Jay Alammar</a></li>
<li><a href="https://twitter.com/osanseviero">Omar Sanseviero</a></li>
<li><a href="https://twitter.com/jxnlco">Jason Liu</a></li>
<li><a href="https://twitter.com/lateinteraction">Omar Khattab</a></li>
<li><a href="https://twitter.com/winglian">Wing Liang</a></li>
<li><a href="https://twitter.com/NousResearch">Nous Research</a></li>
<li><a href="https://twitter.com/alexalbert__">Alex Albert</a></li>
<li><a href="https://twitter.com/mattshumer_">Matt Shumer</a></li>
<li><a href="https://twitter.com/lmsysorg">lmsysorg</a></li>
<li><a href="https://twitter.com/axolotl_ai">Axolotl</a></li>
<li><a href="https://twitter.com/natolambert">Nathan Lambert</a></li>
</ul>
</div><div class="column" style="width:33%;">
<ul>
<li><a href="https://twitter.com/iScienceLuvr">Tanishq Abraham</a></li>
<li><a href="https://twitter.com/_philschmid">Philipp Schmid</a></li>
<li><a href="https://twitter.com/Tim_Dettmers">Tim Dettmers</a></li>
<li><a href="https://twitter.com/eugeneyan">Eugene Yan</a></li>
<li><a href="https://twitter.com/ggerganov">Georgi Gerganov</a></li>
<li><a href="https://twitter.com/DrJimFan">Jim Fan</a></li>
<li><a href="https://twitter.com/swyx">swyx</a></li>
<li><a href="https://twitter.com/charles_irl">Charles Frye</a></li>
<li><a href="https://twitter.com/jefrankle">Jonathan Frankle</a></li>
<li><a href="https://twitter.com/Nils_Reimers">Nils Reimers</a></li>
<li><a href="https://twitter.com/alignment_lab">Alignment Lab AI</a></li>
<li><a href="https://twitter.com/cleavey1985/following">people I follow</a></li>
</ul>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>