# One More Fine-Tuning Example: Machine-generated Text Detection in the Wild

There are many classification tasks and datasets on Hugging Face
you can use for practice. Here we will look at a dataset:

- [yaful/MAGE](https://huggingface.co/datasets/yaful/MAGE)

- *This dataset consists of various human writings and machine-generated texts generated by different LLMs. The data is used to evaluate the effectiveness of machine-generated detection methods, as described in the paper titled "MAGE: Machine-generated Text Detection in the Wild" (available at https://arxiv.org/abs/2305.13242).*

- The code here is the exact same as in the previous lessons. The only changes we have made are the following:

```python
ds_name = "yaful/MAGE" 
id2label = {0: "llm", 1: "human"}
batch_size = 16 # b/c the inputs are larger now
tokenizer_max_length = 1024
pre_fix_name = "yaful-full"
num_train_epochs = 3
```

- You can follow the instructions and code from the previous lessons to train the model.
- You may want to train for fewer epochs or sample the data down significantly with

```python
# useful for debugging and quick training: Just downsample the dataset
# for split in ds.keys():
#     ds[split] = ds[split].shuffle(seed=42).select(range(1000))
```

- The full training took a little over 4 hours on an Nvidia A100, 40 GB.

Here are the results on the validation split:

```
threshold=0.5

Coverage Rate:

Raw counts:
pred_label
llm      28451
human    28341
Name: count, dtype: int64

Proportions:

pred_label
llm      0.500968
human    0.499032
Name: proportion, dtype: float64

Conditional metrics (classification report on predicted subset != UNKNOWN)
              precision    recall  f1-score   support

         llm       0.95      0.96      0.95     27993
       human       0.96      0.95      0.95     28799

    accuracy                           0.95     56792
   macro avg       0.95      0.95      0.95     56792
weighted avg       0.95      0.95      0.95     56792

Overall Accuracy (counting 'UNKNOWN' as wrong): 95.38%
```

You can view the full run [here](https://wandb.ai/christopherdavidlevy/hugging_face_training_jobs/runs/fqcb31zr?nw=nwuserchristopherdavidlevy).

For further practice, pick a dataset you are interested in and try to train a model on it.
Try deploying the model to a Modal web endpoint as well as we showed in the previous lessons.